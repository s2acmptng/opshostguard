
<?php

// standar_report.php [OpsHostGuard - Generated by OpsHostGuard]

/**
 * @SYNOPSIS
 * Dynamically generated standard report page for the OpsHostGuard project.
 * This script loads configurations, verifies user authentication, and displays report data
 * with options for filtering by host and event type, as well as exporting data to PDF.
 * 
 * @DESCRIPTION
 * - Loads configuration settings from external files for report customization.
 * - Verifies user authentication to ensure only authorized users can access the report.
 * - Provides filtering options by host and event type, with export options for PDF generation.
 * - This file is generated automatically by the `DataManager.ps1` PowerShell script 
 *   and should not be modified manually.
 * 
 * @NOTES
 * - Ensure `config.php` and `session_manager.php` are accessible as they provide critical 
 *   settings and session control.
 * - This script is re-generated as needed by the backend and may be overwritten.
 * - Filtering and export options require JavaScript libraries (e.g., `html2pdf.js`, `jsPDF`) 
 *   for client-side functionality.
 * 
 * @ORGANIZATION
 * Developed for: Faculty of Documentation and Communication Sciences at the University of Extremadura.
 * 
 * @DEPENDENCIES
 * - `config.php`: Loads essential configuration settings, including `BASE_URL`.
 * - `session_manager.php`: Manages user authentication and session timeout policies.
 * 
 * @AUTHOR
 * Alberto Ledo [Faculty of Documentation and Communication Sciences] - with assistance from OpenAI
 * IT Department: University of Extremadura - IT Services for Facilities
 * Contact: albertoledo@unex.es
 * 
 * @VERSION
 * 2.0 - Dynamically generated by OpsHostGuard
 * 
 * @LICENSE
 * This script is strictly for internal use within the University of Extremadura.
 * It is designed for the IT infrastructure of the University of Extremadura and may not function 
 * as expected in other environments.
 * 
 * @LINK
 * https://github.com/n7rc/OpsHostGuard
 */

// Load configuration and session management modules
@require_once __DIR__ . '/../../config/config.php';
@require_once __DIR__ . '/../../auth/session_manager.php';

$version = getVersion();
$userData = getUserData();

// Ensure the user is logged in and check for session expiration
checkLogin();
checkSessionTimeout();

?>

<!DOCTYPE html>
<html lang='es'>
<head>
    <meta charset='UTF-8'>
    <meta name='viewport' content='width=device-width, initial-scale=1.0'>
    <link rel="icon" href="<?php echo BASE_URL; ?>/public/assets/images/favicon.png" type="image/png">
    <title><?php echo $userData['HTMLReport']['stdReportTitle']; ?></title>

    <!-- External resources for styling and icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" type="text/css" href="<?php echo BASE_URL; ?>/public/assets/css/main-styles.css">

    <!-- JS Libraries for PDF export functionality -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/0.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.3/html2pdf.bundle.min.js"></script>
    <script src="<?php echo BASE_URL; ?>/public/assets/js/main.js"></script>
</head>
<body id="top">

<!-- Navigation Bar with links to sections within the report -->
<div class="navbar">
    <div class="containernav">
        <a href="<?php echo BASE_URL; ?>/views/dashboard/dashboard.php" class="first-link"><i class="fa-solid fa-house"></i></a>
        <div class="center-links">
            <!-- Links for quick navigation to different report sections -->
            <a href="#summary">Summary</a>
            <a href="#failed-power-on">Failed Power On</a>
            <a href="#failed-shutdown">Failed Shutdown</a>
            <a href="#active-sessions">Active Sessions</a>
            <a href="#load-metrics">Load Metrics</a>
            <a href="#updates">Updates</a>
            <a href="#logs">Critical Logs</a>
            <a href="#Error-logs">Application Logs</a>
            <a href="<?php echo BASE_URL; ?>/views/reports/hardware_inventory_report.php">Hardware Inventory</a>
        </div>
        <a href="<?php echo BASE_URL; ?>/public/index.php" class="last-link"><i class="fa fa-sign-out"></i></a>
    </div>
</div>

<div class="container no-export">
    <!-- Filter Section for Host and Event Type -->
    <div class="filter-container">
        <form id="filterForm">
            <!-- Dropdown to filter the report by host -->
            <label for="hostFilter">Filter by Host:</label>
            <select id="hostFilter" name="host">
                <option value='all'>All Hosts</option>
                <?php include('../../../tmp/cache/frontend/html_options_all_hosts.cache'); ?>
            </select>
        </form>

        <!-- Dropdown to filter the report by event type -->
        <label for="eventType">Event Type:</label>
        <select id="eventType" name="eventType">
            <option value="all">All Events</option>
            <option value="highLoad">High Load</option>
            <option value="powerFailure">Power-on Failed</option>
            <option value="shutdownFailure">Shutdown Failures</option>
        </select>
        
        <!-- Buttons to apply and reset filters -->
        <button type="button" id="applyFiltersButton" onclick="applyFiltersDashboard()">Apply Filters</button>
        <button type="button" id="resetFiltersButton" onclick="resetFilters()">Reset Filters</button>
    </div>
</div>

<div class="container exportable-content">
    <!-- Header section with title and export options -->
    <div class="header">
        <h1><?php echo $userData['HTMLReport']['stdReportTitle']; ?></h1>
        <div class="filter-container button-group no-export">
            <button class="print-button" onclick="openPrintPreview()">Preview and Print Report</button>
            <button class="export-button" onclick="generatePDF()">Export to PDF</button>
        </div>
    </div>

    <!-- Content section for the standard report data (dynamically generated) -->
    <div class="exportable-content">
    <!-- Content for each report section would be dynamically inserted here --><h2 id='summary'>General Summary</h2><table><tr><th>Metric</th><th>Value</th></tr><tr><td>Total Hosts</td><td>5</td></tr><tr><td>Percentage of Failed Hosts (Power On or Shutdown)</td><td>60%</td></tr><tr><td>Percentage of Hosts with High Load (>80%)</td><td>0%</td></tr><tr><td>Percentage of Hosts with Critical Errors</td><td>0%</td></tr><tr><td>Report Execution Time</td><td></td></tr></table><h2 id='failed-power-on'>Hosts Failed to Power On</h2><table><tr><th>Host</th><th>Timestamp</th><th>Status</th></tr><tr><td>i2-ca-29</td><td>2025-12-19 09:01:04</td><td class='Error'>Power-on Failed</td></tr><tr><td>n7rcws</td><td>2025-12-19 09:01:04</td><td class='Error'>Power-on Failed</td></tr><tr><td>opshostguard1</td><td>2025-12-19 09:01:04</td><td class='Error'>Power-on Failed</td></tr></table><h2 id='failed-shutdown'>Hosts Failed to Shutdown</h2><table><tr><th>Host</th><th>Timestamp</th><th>Status</th></tr></table><h2 id='active-sessions'>Active Sessions on Hosts</h2><table><tr><th>Host</th><th>Session Name</th><th>Timestamp</th></tr></table><h2 id='load-metrics'>Host Load Metrics</h2><table><tr><th>Host</th><th>CPU (%)</th><th>RAM (%)</th><th>Disk1 (%)</th><th>Disk2 (%)</th><th>Disk3 (%)</th></tr></table><h2 id='updates'>Updates Installed</h2><table><tr><th>Host</th><th>Timestamp</th><th>Update</th><th>Result</th></tr><tr><td>U00200025-BAV02</td><td>12/19/2025 09:01:50</td><td>Failed</td><td class=''></td></tr><tr><td>U00200025-BAV02</td><td>12/19/2025 09:01:51</td><td>Failed</td><td class=''></td></tr><tr><td>U00200025-BAV02</td><td>12/19/2025 09:02:05</td><td>Failed</td><td class=''></td></tr></table><h2 id='updates'>Verification of the latest updates installation</h2><table><tr><th>Host</th><th>Date</th><th>Update</th><th>Result</th></tr></table><h2 id='logs'>Critical Logs (Last 7 Days)</h2><table><tr><th>Time Created</th><th>Event ID</th><th>Log Type</th><th>Message</th></tr></table><h2 id='Error-logs'>Application Error Logs (Last 7 Days)</h2><table><tr><th>Time Created</th><th>Event ID</th><th>Level</th><th>Message</th></tr></table>        
    <p class="version-Info"><?php echo "Version: " . $version; ?> - Date: </p></div></body></html>
